# Домашнее задание к занятию 3 "Базы данных, их типы" - Карпов Антон Юрьевич

## Задание 1. СУБД

## Кейс
Крупная строительная компания, которая также занимается проектированием и девелопментом, решила создать правильную архитектуру для работы с данными. Ниже представлены задачи, которые необходимо решить для каждой предметной области.

Какие типы СУБД, на ваш взгляд, лучше всего подойдут для решения этих задач и почему?

1.1. Бюджетирование проектов с дальнейшим формированием финансовых аналитических отчётов и прогнозирования рисков. СУБД должна гарантировать целостность и чёткую структуру данных.

1.1.* Хеширование стало занимать длительно время, какое API можно использовать для ускорения работы?

1.2. Под каждый девелоперский проект создаётся отдельный лендинг, и все данные по лидам стекаются в CRM к маркетологам и менеджерам по продажам. Какой тип СУБД лучше использовать для лендингов и для CRM? СУБД должны быть гибкими и быстрыми.

1.2.* Можно ли эту задачу закрыть одной СУБД? И если да, то какой именно СУБД и какой реализацией?

1.3. Отдел контроля качества решил создать базу по корпоративным нормам и правилам, обучающему материалу и так далее, сформированную согласно структуре компании. СУБД должна иметь простую и понятную структуру.

1.3.* Можно ли под эту задачу использовать уже существующую СУБД из задач выше и если да, то как лучше это реализовать?

1.4. Департамент логистики нуждается в решении задач по быстрому формированию маршрутов доставки материалов по объектам и распределению курьеров по маршрутам с доставкой документов. СУБД должна уметь быстро работать со связями.

1.4.* Можно ли к этой СУБД подключить отдел закупок или для них лучше сформировать свою СУБД в связке с СУБД логистов?

1.5.* Можно ли все перечисленные выше задачи решить, используя одну СУБД? Если да, то какую именно?

Приведите ответ в свободной форме.


## Решение 1

### 1.1. Бюджетирование проектов и финансовые отчёты
Тип СУБД: реляционная (например, PostgreSQL, Microsoft SQL Server, Oracle). 

Причина: обеспечение строгой структуры данных и целостность, что критично для финансовых операций. Они поддерживают транзакции (ACID-совместимость). Также, к примеру, PostgreSQL, имеет расширения для финансовой аналитики (например, TimescaleDB для временных рядов, PostGIS) и поддерживает JSON/JSONB для гибкого обмена данными. 

Ускорение хеширования: если хеширование занимает много времени, можно использовать специализированные API или библиотеки для ускорения вычислений, например, OpenSSL, которая оптимизирована для криптографических операций. Также как вариант можно использовать кэширование с помощью Redis или Memcached для хранения результатов хеширования в оперативной памяти, что снизит нагрузку на основную СУБД.

### 1.2. Лендинги и CRM
Для лендингов: NoSQL (например, MongoDB). 

Для CRM: реляционная СУБД (например, PostgreSQL или MySQL). 

Причина: лендинги часто работают с неструктурированными или полуструктурированными данными (контент, формы), для которых подходят NoSQL-системы. CRM-системы требуют строгой структуры, поддержки транзакций и сложных запросов, что характерно для реляционных СУБД. 

Можно ли использовать одну СУБД? Теоретически да, если выбрать мультимодельную СУБД (например, ArangoDB), которая поддерживает как документную, так и реляционную модели данных. Но это справедливо лишь тогда, когда требования к лендингам и CRM различаются несущественно, в ином случае лучше использовать отдельные СУБД для гибкости и производительности. 

### 1.3. База корпоративных норм и правил
Тип СУБД: реляционная (например, PostgreSQL). 
Причина: реляционные СУБД хорошо подходят для хранения структурированных данных с чёткой иерархией, что удобно для организации данных о корпоративных нормах, правилах и обучающем материале. 
Использование существующей СУБД: да, можно использовать ту же реляционную СУБД, что и для бюджетирования (например, PostgreSQL). Это упростит интеграцию и управление данными.

### 1.4. Логистика (оптимизация маршрутов)
Тип СУБД: графовая (например, Neo4j, Amazon Neptune). 

Причина: графовые СУБД специализированы на работе со сложными связями между объектами (точки доставки, материалы, курьеры). Они позволяют эффективно моделировать и анализировать маршруты, что критично для задач логистики. 

Подключение отдела закупок: можно подключить отдел закупок к той же графовой СУБД, так как она гибкая в моделировании связей между материалами, поставщиками, заказами и другими сущностями. Однако если у отдела закупок есть уникальные требования, которые не пересекаются с задачами логистики, может быть лучше создать отдельную СУБД. 

### 1.5. Можно ли решить все задачи одной СУБД?
Да, теоретически возможно использовать мультимодельную СУБД, такую как ArangoDB, которая поддерживает реляционную, графовую и ключ-значение модели данных. Это позволит работать с разными типами данных и связями в рамках одной системы. Однако выбор такой СУБД зависит от сложности задач, нагрузки, требований к производительности и навыков команды. Для критически важных задач (например, финансов) лучше использовать специализированные решения.

## Задание 2. Транзакции

2.1. Пользователь пополняет баланс счёта телефона, распишите пошагово, какие действия должны произойти для того, чтобы транзакция завершилась успешно. Ориентируйтесь на шесть действий.

2.1.* Какие действия должны произойти, если пополнение счёта телефона происходило бы через автоплатёж?

Приведите ответ в свободной форме.

## Решение 2

1. Инициирование операции - пользователь выбирает способ пополения, вводит номер телефона и сумму платежа, а также выбирает способ оплаты.

2. Проверка данных и авторизация - система проверяет корректность введённого номера. При оплате картой — запрос на авторизацию в банк‑эмитент (проверка баланса, CVV/3‑D Secure). При наличных — приём средств устройством.

3. Резервирование средств - банк или платёжный агрегатор блокирует сумму на счёте пользователя (пре‑авторизация), генерируется уникальный ID транзакции для отслеживания.

4. Передача данных оператору связи - платёжная система отправляет запрос оператору с параметрами: номер телефона, сумма, ID транзакции. Оператор проверяет доступность услуги (статус номера, лимиты).

5. Выполнение зачисления - оператор увеличивает баланс абонента на указанную сумму. Фиксируется время пополнения и источник платежа, 
формируется внутренний журнал операций.

6. Подтверждение и уведомление - пользователю приходит чек/SMS/push с деталями платежа (сумма, остаток, комиссия). Статус транзакции обновляется в системе. Средства окончательно списываются с платёжного инструмента пользователя.

### Пополнение через автоплатеж:

1. Настройка автоплатежа - пользователь задаёт параметры в приложении/на сайте: номер телефона, пороговое значение баланса (например, ≤ 100 руб.), сумму пополнения, периодичность или условие срабатывания. Привязывает платёжный инструмент (карту, кошелёк).

2. Мониторинг баланса - система регулярно проверяет текущий баланс указанного номера, при достижении порога инициируется платёж. Либо же инициируется по достижению определенной даты и времени.

3. Автоматическая авторизация - система использует сохранённые платёжные данные, проводится проверка достаточности средств без участия пользователя.

4. Резервирование и передача запроса - сумма блокируется на счёте пользователя, запрос отправляется оператору связи с меткой «Автоплатёж» и ID подписки.

5. Зачисление средств - оператор пополняет баланс абонента, обновляется история автоплатежей в профиле пользователя.

6. Уведомление и логирование

пользователь получает уведомление о выполнении автоплатежа (SMS/push/e‑mail). В личном кабинете отображается запись о транзакции. Система планирует следующий контроль баланса согласно настройкам.

## Задание 3. SQL vs NoSQL

3.1. Напишите пять преимуществ SQL-систем по отношению к NoSQL.

3.1.* Какие, на ваш взгляд, преимущества у NewSQL систем перед SQL и NoSQL.

Приведите ответ в свободной форме.

## Решение 3

### Пять преимуществ SQL-систем по отношению к NoSQL:

1. Гарантия целостности данных и ACID-свойства. Это критически важно для приложений, где требуется абсолютная точность данных, например, в банковском деле, e-commerce и ERP-системах. NoSQL-системы часто ориентированы на доступность и устойчивость к разделам (теорема CAP), а не на строгую согласованность. 

2. Структурированность и жёсткая схема данных. В SQL заранее определяется структура таблиц и типы данных, что минимизирует дублирование и аномалии обновления благодаря нормализации. Это обеспечивает предсказуемость и упрощает работу с данными, имеющими чёткие взаимосвязи. В NoSQL отсутствует жёсткая схема, что может привести к трудностям с обработкой запросов при частой смене структуры данных. 

3. Мощный язык запросов и поддержка сложных операций. SQL позволяет выполнять сложные JOIN-операции, агрегации и другие запросы, которые удобны для анализа и отчётности. NoSQL-системы, как правило, не поддерживают или ограниченно поддерживают JOIN, что усложняет работу со связанными данными. 

4. Для SQL существует множество инструментов для администрирования, мониторинга, ORM (Object-Relational Mapping) и аналитики. Это упрощает разработку, поддержку и интеграцию с другими системами. У NoSQL-систем экосистема менее зрелая, хотя в последние годы ситуация улучшается. 

5. Строгий контроль доступа и безопасность. SQL-базы данных предоставляют детальный контроль доступа на уровне пользователей, ролей и привилегий. Можно ограничивать доступ к конкретным таблицам, столбцам или строкам. В NoSQL управление доступом может быть менее строгим, хотя современные системы (например, MongoDB) также реализуют механизмы аутентификации и контроля доступа. 

### Преимущества NewSQL-систем перед SQL и NoSQL:

1. Сочетание ACID-транзакций и горизонтальной масштабируемости. NewSQL сохраняет гарантии ACID, как в обычных SQL-системах, но при этом обеспечивает масштабируемость, характерную для NoSQL. Это достигается за счёт распределённых архитектур, шардирования и репликации. 

2. Высокая производительность. NewSQL-системы используют современные архитектуры и параллельную обработку данных, что позволяет достигать высокой производительности даже при больших нагрузках. Некоторые реализации хранят данные в оперативной памяти, что ускоряет обработку запросов. 

3. Совместимость с SQL. NewSQL часто поддерживает SQL-подобный интерфейс, что упрощает переход для разработчиков, знакомых с SQL. При этом могут добавляться расширения SQL для повышения гибкости. 

4. Устойчивость к отказам и высокая доступность. За счёт распределённой архитектуры и механизмов репликации NewSQL обеспечивает отказоустойчивость и доступность данных даже при сбоях отдельных узлов. 

## Задание 4. Кластеры

Необходимо производить большое количество вычислений при работе с огромным количеством данных, под эту задачу выделено 1000 машин.

На основе какого критерия будете выбирать тип СУБД и какая модель распределённых вычислений здесь справится лучше всего и почему?

Приведите ответ в свободной форме.

## Решение 4.

Для задачи с 1000 машинами и большими объёмами вычислений оптимальным выбором будет NewSQL-СУБД в сочетании с моделью MapReduce или Spark. Это обеспечит:

1. Горизонтальное масштабирование и эффективное использование ресурсов кластера;

2. Поддержку ACID-свойств, если требуется строгая согласованность данных;

3. Высокую производительность за счёт параллельной обработки. 

Если данные неструктурированные или требуется максимальная гибкость, можно рассмотреть NoSQL-системы (например, Apache Cassandra или HBase) с MapReduce. 

Для строго структурированных данных и транзакционных нагрузок лучше подойдут реляционные СУБД с кластеризацией (например, PostgreSQL в кластерной конфигурации), но их масштабируемость может быть ограничена.






 




